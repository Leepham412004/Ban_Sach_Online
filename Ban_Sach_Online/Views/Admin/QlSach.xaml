<Window x:Class="Ban_Sach_Online.Views.Admin.QlSach"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="clr-namespace:Ban_Sach_Online.Converters"
        xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
        mc:Ignorable="d"
        Title="Quản lý Sách" Height="600" Width="1000">
    <Window.Resources>
        <conv:ImagePathConverter x:Key="ImagePathConverter"/>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Thanh tìm kiếm + sắp xếp -->
        <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,10">
            <xctk:WatermarkTextBox x:Name="txtTimKiem" Width="332" Margin="0,0,10,0"
                                   Watermark="Tìm theo tên sách..."
                                   KeyDown="txtTimKiem_KeyDown"/>
            <Button Content="Tìm kiếm" Width="100" Click="BtnTimKiem_Click"
                    Background="#FF2D4C33" Foreground="#FFEFE7BF"/>

            <TextBlock Text="Sắp xếp theo:" VerticalAlignment="Center" Margin="20,0,5,0" Foreground="#FF202A22"/>
            <ComboBox x:Name="cbSapXep" Width="180" SelectionChanged="CbSapXep_SelectionChanged"
                      Foreground="#FF3C3C3C" Background="#FF202A22" BorderBrush="#FF202A22">
                <ComboBoxItem Content="ID (tăng dần)" Tag="id_asc"/>
                <ComboBoxItem Content="ID (giảm dần)" Tag="id_desc"/>
                <ComboBoxItem Content="Thêm mới nhất" Tag="date_desc"/>
                <ComboBoxItem Content="Thêm cũ nhất" Tag="date_asc"/>
            </ComboBox>
        </StackPanel>

        <!-- Danh sách sách -->
        <ListView x:Name="lvSach"
          Grid.Row="1"
          SelectionMode="Single"
          MouseDoubleClick="LvSach_MouseDoubleClick"
          BorderThickness="0"
          HorizontalContentAlignment="Center"
          VerticalContentAlignment="Top"
          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
          ScrollViewer.VerticalScrollBarVisibility="Auto">

            <ListView.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel IsItemsHost="True"
                       Orientation="Horizontal"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Top"
                       Margin="10"/>
                </ItemsPanelTemplate>
            </ListView.ItemsPanel>

            <ListView.ItemTemplate>
                <DataTemplate>
                    <Border BorderBrush="#FFDADADA"
                    BorderThickness="1"
                    CornerRadius="10"
                    Margin="8"
                    Padding="8"
                    Background="White"
                    Width="160"
                    Height="320"
                    SnapsToDevicePixels="True">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <!-- Ảnh sách -->
                            <Border Background="#FFF8F8F8" CornerRadius="6" 
                                    BorderBrush="#FFDDDDDD" BorderThickness="1"
                                    Width="140" Height="180"
                                    HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Image Stretch="Uniform" Width="140" Height="180"
                                        Source="{Binding AnhSachs[0].Url, Converter={StaticResource ImagePathConverter}}"/>
                            </Border>

                            <!-- Tên sách -->
                            <TextBlock Text="{Binding TenSach}"
                               FontWeight="Bold"
                               Foreground="#FF202A22"
                               FontSize="13"
                               TextAlignment="Center"
                               Margin="0,8,0,0"
                               TextWrapping="Wrap"
                               Height="40"
                               ToolTip="{Binding TenSach}"
                               TextTrimming="CharacterEllipsis"/>
                            <TextBlock Text="{Binding SoLuongDaBan, StringFormat=Đã bán: {0} }"
                               FontSize="12"
                               Foreground="Gray"
                               TextAlignment="Center"
                               Margin="0,4,0,0"/>
                            <!-- Biểu tượng nổi bật -->
                            <CheckBox Content="Nổi bật" 
                              IsChecked="{Binding LaNoiBat, Mode=TwoWay}"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                              Margin="0,3,0,0"
                              Foreground="DarkOrange"
                              FontWeight="Bold"/>
                            <!-- Flash Sale -->
                            <CheckBox Content="Flash Sale"
                                  IsChecked="{Binding LaFlashSale, Mode=TwoWay}"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  Margin="0,3,0,0"
                                  Foreground="Red"
                                  FontWeight="Bold"/>
                            <!-- Ngày đôi -->
                            <CheckBox Content="Ngày đôi"
                                  IsChecked="{Binding LaNgayDoi, Mode=TwoWay}"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  Margin="0,3,0,0"
                                  Foreground="HotPink"
                  FontWeight="Bold"/>
                        </StackPanel>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- Nút thao tác -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,10">
            <Button Content="Sửa sách" Width="120" Height="35" 
                    Click="BtnSuaSach_Click" Background="#FF2D4C33" Foreground="#FFEFE3A6"/>

            <Button Content="Xóa sách" Width="120" Height="35" Margin="10,0,0,0" 
                    Click="BtnXoaSach_Click" Background="#FF2D4C33" Foreground="#FFE4DDB4"/>

            <Button Content="Thêm sách" Width="120" Height="35" Margin="10,0,0,0"
                    Click="BtnThemSach_Click" Foreground="#FFEFE7BF" Background="#FF2D4C33"/>
            <Button x:Name="BtnNoiBat"
                    Content="⭐ Đặt Nổi Bật"
                    Width="140" Height="35" Margin="10,0,0,0"
                    Click="BtnNoiBat_Click"
                    Background="#FFFDD835"
                    Foreground="Black"
                    ToolTip="Đặt nổi bật - Flash Sale - Ngày đôi">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#FFFDD835"/>
                        <Setter Property="Foreground" Value="Black"/>
                        <Setter Property="Cursor" Value="Hand"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="BorderBrush" Value="#FFD6C700"/>
                        <Setter Property="BorderThickness" Value="1"/>
                        <Setter Property="Effect">
                            <Setter.Value>
                                <DropShadowEffect Color="Gold" BlurRadius="5" ShadowDepth="0"/>
                            </Setter.Value>
                        </Setter>

                        <Style.Triggers>
                            <!-- Hiệu ứng khi di chuột -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FFFFEB3B"/>
                                <Setter Property="Foreground" Value="#FF1A1A1A"/>
                                <Setter Property="ToolTip" Value="🔥 Đặt nổi bật / Flash Sale / Ngày đôi"/>
                                <Setter Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="Orange" BlurRadius="12" ShadowDepth="0"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.05" ScaleY="1.05"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            <Button x:Name="BtnFlashSale"
                    Content="🔥 Flash Sale"
                    Width="130" Height="35" Margin="10,0,0,0"
                    Click="BtnFlashSale_Click"
                    Background="#FFFF7043"
                    Foreground="White"
                    FontWeight="Bold"
                    ToolTip="Đặt sách vào Flash Sale"/>

            <Button x:Name="BtnNgayDoi"
                    Content="💕 Ngày Đôi"
                    Width="130" Height="35" Margin="10,0,0,0"
                    Click="BtnNgayDoi_Click"
                    Background="#FFEC407A"
                    Foreground="White"
                    FontWeight="Bold"
                    ToolTip="Đặt sách vào chương trình Ngày Đôi (11/11, 12/12...)"/>
        </StackPanel>
    </Grid>
</Window>
